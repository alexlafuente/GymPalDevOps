nameOverride: ""
fullnameOverride: ""

global:
  domain: "gympal.com" # Global domain for the GymPal applications
  storageClass: standard # Default storage class for persistent volumes. Th

apiVersion: argoproj.io/v1alpha1

kind: Application # Argo CD Application for bootstrapping GymPal DevOps

metadata:
    namespace: argocd
    finalizers:
      - resources-finalizer.argocd.argoproj.io

# Generic spec values applied to all Applications unless overridden in their specific sections. This helps to maintain consistency across all deployed applications
spec: 
  destination:
    server: https://kubernetes.default.svc # Target cluster API server
  syncPolicy:
    automated:
      prune: true # Delete resources that are no longer defined in Git
      selfHeal: true # Automatically sync if the live state deviates from Git
    syncOptions: # IMPORTANT: all true except for base manifests and cert-manager-crds (which manages namespaces itself)
      - CreateNamespace=true # Create the target namespace if it doesn't exist
    retry:
      limit: 5
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 3m0s
  project: default # Argo CD project

# Habilitation for each component's (subchart) deployment
argoCD:
  enabled: true # Enable Argo CD installation
  metadata:
    name: argo-cd
  annotations:
    syncWave: -2 # Argo CD must be created before anything else
  spec:
    source:
      chart: argo-cd
      repoURL: https://argoproj.github.io/argo-helm
      targetRevision: "9.1.3"
    destination:
      namespace: argocd

ingress:
  enabled: true # Enable ingress for Argo CD
  metadata:
    name: ingress-nginx
  annotations:
    syncWave: 1 # ingress classes must exist before anything referencing them
  spec:
    source:
      chart: ingress-nginx
      repoURL: https://kubernetes.github.io/ingress-nginx
      targetRevision: "4.14.0" # Specific version of ingress-nginx chart to use
    destination:
      namespace: ingress-nginx
          
# Cert manager for TLS certificate management
certManager:
  enabled: true # Enable deployment of cert-manager
  metadata:
    name: cert-manager
  annotations:
    syncWave: 2 # Cert-manager depends on CRDs being installed first
  spec:
    source:
      chart: cert-manager
      repoURL: https://charts.jetstack.io
      targetRevision: "1.19.1"
    destination:
      namespace: cert-manager

certManagerCRDs:
    enabled: true
    metadata:
      name: cert-manager-crds
    annotations:
      syncWave: -1 # Ensure CRDs are installed first, before cert-manager itself
    spec:
      source:
        chart: cert-manager-crds
        repoURL: https://wiremind.github.io/wiremind-helm-charts
        targetRevision: "1.19.1"
      # No namespace is set because CRDs are cluster-wide resources, which do not belong to any namespace.

# Backend application configuration
gympalBackend:
  enabled: true
  metadata:
    name: gympal-backend
  annotations:
    syncWave: 3 # Backend app depend on namespaces from base
  spec:
    source:
      repoURL: https://github.com/smyha/PTI-GymPalBack.git
      targetRevision: HEAD
      path: charts/backend
      helm:
        valueFiles:
          - values.yaml
    destination:
      namespace: gympal

# Frontend application configuration
gympalFrontend:
  enabled: true
  metadata:
    name: gympal-frontend
  annotations:
    syncWave: 4 # Frontend app depends on backend
  spec:
    source:
      repoURL: https://github.com/Arnaugg9/Gympalfrontend.git
      targetRevision: HEAD
      path: charts/frontend
      helm:
        valueFiles:
          - values.yaml
    destination:
      namespace: gympal

# Base manifests ArgoCD Application configuration, such as ClusterIssuer, Namespaces, etc.
baseManifests:
  enabled: true
  metadata:
    name: base-manifests
  annotations:
    syncWave: 0 # Base manifests must be created before any application deployments, and after CDRs
  spec:
    source:
      repoURL: https://github.com/alexlafuente/GymPalDevOps.git # Git repository URL containing bootstrap manifests
      targetRevision: HEAD # Branch, tag, or commit to sync from
      path: bootstrap/manifests 
      directory:
        recurse: true # Process all YAML files in the directory
    destination:
      namespace: default # This namespace is set to 'default' because some of the manifests are cluster-wide resources (like ClusterIssuer) or have their own namespace defined within the manifest