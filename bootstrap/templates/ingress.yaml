{{- if .Values.ingress.enabled }}
apiVersion: {{ .Values.apiVersion }}
kind: {{ .Values.kind }}
metadata:
  name: {{ .Values.ingress.metadata.name }}
  namespace: {{.Values.metadata.namespace }} # Namespace where the Argo CD Application will be created
  annotations:
    # Define sync wave for ingress-nginx deployment. This is required to ensure it deploys before applications depending on it.
    argocd.argoproj.io/sync-wave: {{ .Values.ingress.annotations.syncWave | quote }} # Sync wave for ordering. Quote used to ensure it's treated as a string.
# No finalizers needed here as ingress-nginx manages its own resources and namespaces, which prevents potential issues during deletion.
spec:
  project: {{ .Values.spec.project }}
  source:
    # Ingress Nginx Helm chart details
    chart: {{ .Values.ingress.spec.source.chart }}
    repoURL: {{ .Values.ingress.spec.source.repoURL }}
    targetRevision: {{ .Values.ingress.spec.source.targetRevision }}
    helm:
      # Values file for Ingress Nginx configuration (retrieved from values/ingress.yaml)
      values: |
{{ .Files.Get "values/ingress.yaml" | indent 8 }}
  destination:
    # Target Kubernetes API server
    server: {{ .Values.spec.destination.server }}
    # Destination namespace for Ingress Nginx resources
    namespace: {{ .Values.ingress.spec.destination.namespace }}
  syncPolicy: {{- toYaml .Values.spec.syncPolicy | nindent 4 }}
{{- end }}